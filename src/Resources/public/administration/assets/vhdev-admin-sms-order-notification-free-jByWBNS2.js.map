{"version":3,"file":"vhdev-admin-sms-order-notification-free-jByWBNS2.js","sources":["../../../app/administration/src/component/vhdev-twilio-validate-button/vhdev-twilio-validate-button.html.twig","../../../app/administration/src/component/vhdev-twilio-validate-button/index.js"],"sourcesContent":["{% block vhdev_twilio_validate_button %}\n    <div class=\"vhdev-twilio-validate-button\" style=\"margin-top: 20px;\">\n        <sw-button\n            variant=\"primary\"\n            :disabled=\"buttonDisabled\"\n            :isLoading=\"isLoading\"\n            @click=\"validateCredentials\">\n            <sw-icon name=\"regular-check-circle\" v-if=\"isValidated && !isLoading\"></sw-icon>\n            {{ $tc('vhdev-sms.validation.buttonText') }}\n        </sw-button>\n        <p style=\"margin-top: 10px; font-size: 12px; color: #52667a;\">\n            {{ $tc('vhdev-sms.validation.buttonHelp') }}\n        </p>\n    </div>\n{% endblock %}\n","import template from './vhdev-twilio-validate-button.html.twig';\n\nconst { Component, Mixin } = Shopware;\n\nComponent.register('vhdev-twilio-validate-button', {\n    template,\n\n    inject: ['systemConfigApiService', 'loginService'],\n\n    mixins: [\n        Mixin.getByName('notification')\n    ],\n\n    data() {\n        return {\n            isLoading: false,\n            isValidated: false\n        };\n    },\n\n    computed: {\n        buttonDisabled() {\n            return this.isLoading;\n        },\n\n        salesChannelId() {\n            // Піднімаємося по дереву до sw-system-config компонента\n            let parent = this.$parent;\n            let level = 0;\n            \n            while (parent && level < 20) {\n                // Шукаємо currentSalesChannelId або salesChannelId\n                if (parent.currentSalesChannelId) {\n                    if (typeof parent.currentSalesChannelId === 'string' && parent.currentSalesChannelId !== 'null') {\n                        return parent.currentSalesChannelId;\n                    }\n                }\n                \n                if (parent.salesChannelId) {\n                    if (typeof parent.salesChannelId === 'string' && parent.salesChannelId !== 'null') {\n                        return parent.salesChannelId;\n                    }\n                }\n                \n                parent = parent.$parent;\n                level++;\n            }\n            \n            return null;\n        }\n    },\n\n    methods: {\n        async validateCredentials() {\n            this.isLoading = true;\n            this.isValidated = false;\n\n            try {\n                const salesChannelId = this.salesChannelId;\n\n                // Отримуємо токен\n                let bearerToken = null;\n                try {\n                    const bearerAuth = JSON.parse(localStorage.getItem('bearerAuth'));\n                    if (bearerAuth && bearerAuth.access) {\n                        bearerToken = bearerAuth.access;\n                    }\n                } catch (e) {\n                    // Fallback to loginService\n                }\n\n                if (!bearerToken) {\n                    const auth = this.loginService.getBearerAuthentication();\n                    if (auth && auth.access) {\n                        bearerToken = auth.access;\n                    }\n                }\n\n                const headers = {\n                    'Content-Type': 'application/json',\n                    'Accept': 'application/json'\n                };\n\n                if (bearerToken) {\n                    headers['Authorization'] = `Bearer ${bearerToken}`;\n                }\n\n                const response = await fetch('/api/_action/vhdev-sms/validate-twilio', {\n                    method: 'POST',\n                    headers: headers,\n                    credentials: 'include',\n                    body: JSON.stringify({\n                        salesChannelId: salesChannelId\n                    })\n                });\n\n                if (!response.ok) {\n                    const errorData = await response.json().catch(() => ({}));\n                    throw new Error(errorData.errors?.[0]?.detail || errorData.message || `HTTP ${response.status}`);\n                }\n\n                const result = await response.json();\n\n                if (result.valid) {\n                    this.isValidated = true;\n                    let message = result.message;\n                    if (result.accountName) {\n                        message += ` (${result.accountName})`;\n                    }\n                    \n                    this.createNotificationSuccess({\n                        title: this.$tc('vhdev-sms.validation.successTitle'),\n                        message: message\n                    });\n                } else {\n                    this.createNotificationError({\n                        title: this.$tc('vhdev-sms.validation.errorTitle'),\n                        message: result.message || this.$tc('vhdev-sms.validation.errorMessage')\n                    });\n                }\n            } catch (error) {\n                console.error('Twilio validation error:', error);\n                \n                this.createNotificationError({\n                    title: this.$tc('vhdev-sms.validation.errorTitle'),\n                    message: error.message || this.$tc('vhdev-sms.validation.errorDefault')\n                });\n            } finally {\n                this.isLoading = false;\n            }\n        }\n    }\n});\n"],"names":["template","Component","Mixin","parent","level","_a","_b","salesChannelId","bearerToken","bearerAuth","auth","headers","response","errorData","result","message","error"],"mappings":"AAAA,MAAAA,EAAe,+eCET,CAAE,UAAAC,EAAW,MAAAC,CAAK,EAAK,SAE7BD,EAAU,SAAS,+BAAgC,CAC/C,SAAAD,EAEA,OAAQ,CAAC,yBAA0B,cAAc,EAEjD,OAAQ,CACJE,EAAM,UAAU,cAAc,CACtC,EAEI,MAAO,CACH,MAAO,CACH,UAAW,GACX,YAAa,EACzB,CACA,EAEI,SAAU,CACN,gBAAiB,CACb,OAAO,KAAK,SACxB,EAEQ,gBAAiB,CAEb,IAAIC,EAAS,KAAK,QACdC,EAAQ,EAEZ,KAAOD,GAAUC,EAAQ,IAAI,CAEzB,GAAID,EAAO,uBACH,OAAOA,EAAO,uBAA0B,UAAYA,EAAO,wBAA0B,OACrF,OAAOA,EAAO,sBAItB,GAAIA,EAAO,gBACH,OAAOA,EAAO,gBAAmB,UAAYA,EAAO,iBAAmB,OACvE,OAAOA,EAAO,eAItBA,EAASA,EAAO,QAChBC,GAChB,CAEY,OAAO,IACnB,CACA,EAEI,QAAS,CACL,MAAM,qBAAsB,CDrDpC,IAAAC,EAAAC,ECsDY,KAAK,UAAY,GACjB,KAAK,YAAc,GAEnB,GAAI,CACA,MAAMC,EAAiB,KAAK,eAG5B,IAAIC,EAAc,KAClB,GAAI,CACA,MAAMC,EAAa,KAAK,MAAM,aAAa,QAAQ,YAAY,CAAC,EAC5DA,GAAcA,EAAW,SACzBD,EAAcC,EAAW,OAEjD,MAA4B,CAE5B,CAEgB,GAAI,CAACD,EAAa,CACd,MAAME,EAAO,KAAK,aAAa,wBAAuB,EAClDA,GAAQA,EAAK,SACbF,EAAcE,EAAK,OAE3C,CAEgB,MAAMC,EAAU,CACZ,eAAgB,mBAChB,OAAU,kBAC9B,EAEoBH,IACAG,EAAQ,cAAmB,UAAUH,CAAW,IAGpD,MAAMI,EAAW,MAAM,MAAM,yCAA0C,CACnE,OAAQ,OACR,QAASD,EACT,YAAa,UACb,KAAM,KAAK,UAAU,CACjB,eAAgBJ,CACxC,CAAqB,CACrB,CAAiB,EAED,GAAI,CAACK,EAAS,GAAI,CACd,MAAMC,EAAY,MAAMD,EAAS,KAAI,EAAG,MAAM,KAAO,CAAA,EAAG,EACxD,MAAM,IAAI,QAAMN,GAAAD,EAAAQ,EAAU,SAAV,YAAAR,EAAmB,KAAnB,YAAAC,EAAuB,SAAUO,EAAU,SAAW,QAAQD,EAAS,MAAM,EAAE,CACnH,CAEgB,MAAME,EAAS,MAAMF,EAAS,KAAI,EAElC,GAAIE,EAAO,MAAO,CACd,KAAK,YAAc,GACnB,IAAIC,EAAUD,EAAO,QACjBA,EAAO,cACPC,GAAW,KAAKD,EAAO,WAAW,KAGtC,KAAK,0BAA0B,CAC3B,MAAO,KAAK,IAAI,mCAAmC,EACnD,QAASC,CACjC,CAAqB,CACrB,MACoB,KAAK,wBAAwB,CACzB,MAAO,KAAK,IAAI,iCAAiC,EACjD,QAASD,EAAO,SAAW,KAAK,IAAI,mCAAmC,CAC/F,CAAqB,CAErB,OAAqBE,EAAO,CACZ,QAAQ,MAAM,2BAA4BA,CAAK,EAE/C,KAAK,wBAAwB,CACzB,MAAO,KAAK,IAAI,iCAAiC,EACjD,QAASA,EAAM,SAAW,KAAK,IAAI,mCAAmC,CAC1F,CAAiB,CACjB,QAAa,CACG,KAAK,UAAY,EACjC,CACA,CACA,CACA,CAAC"}